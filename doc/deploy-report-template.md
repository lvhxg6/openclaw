# 部署报告模板

## 报告示例

---

# 📋 部署报告 - product-a v1.3.0

## 📌 基本信息

| 项目 | 内容 |
|------|------|
| 产品名称 | product-a |
| 目标版本 | v1.3.0 |
| 原版本 | v1.2.0 |
| 升级类型 | 增量 |
| 目标环境 | test-server-01 (测试环境) |
| 部署时间 | 2026-01-31 10:30:00 |
| 总耗时 | 3m 25s |
| 部署结果 | ✅ 成功 |
| 操作人 | 张三 (通过钉钉触发) |
| 部署ID | deploy-20260131-103000-abc123 |

---

## 📦 部署内容

### JAR 包

| 文件名 | 大小 | MD5 |
|--------|------|-----|
| user-service-1.3.0.jar | 15.2 MB | abc123... |
| order-service-1.3.0.jar | 12.8 MB | def456... |

### DDL 脚本

| 序号 | 文件名 | 描述 | 执行结果 | 耗时 |
|------|--------|------|----------|------|
| 1 | 001_add_user_index.sql | 添加用户表手机号索引 | ✅ 成功 | 0.3s |
| 2 | 002_add_order_column.sql | 订单表新增导出状态字段 | ✅ 成功 | 0.5s |

### DML 脚本

| 序号 | 文件名 | 描述 | 执行结果 | 耗时 | 影响行数 |
|------|--------|------|----------|------|----------|
| 1 | 001_init_config.sql | 初始化系统配置 | ✅ 成功 | 0.2s | 5 |

### 配置变更

| 文件 | 变更内容 |
|------|----------|
| application.yml | 新增 `redis.timeout` 配置 |

---

## ⏱️ 执行时间线

```
10:30:00  ▶ 开始部署
10:30:05  ✅ 预检查完成
          │  • SSH 连通性: 通过
          │  • 数据库连通性: 通过
          │  • 磁盘空间: 5.2GB 可用
          │  • 当前版本: v1.2.0
10:30:15  ✅ 备份完成
          │  • JAR 备份: /backup/20260131/user-service-1.2.0.jar
          │  • 配置备份: /backup/20260131/application.yml
10:30:25  ✅ 服务停止
          │  • user-service: 已停止 (PID: 12345)
          │  • order-service: 已停止 (PID: 12346)
10:30:30  ✅ SQL 执行完成
          │  • DDL: 2/2 成功
          │  • DML: 1/1 成功
10:31:00  ✅ JAR 部署完成
          │  • user-service-1.3.0.jar: 已上传
          │  • order-service-1.3.0.jar: 已上传
10:32:30  ✅ 服务启动完成
          │  • user-service: 已启动 (PID: 23456)
          │  • order-service: 已启动 (PID: 23457)
10:33:00  ✅ 健康检查通过
10:33:25  ✅ 验证完成
10:33:25  ■ 部署结束
```

---

## ✅ 验证结果

| 检查项 | 结果 | 详情 |
|--------|------|------|
| 健康检查 | ✅ 通过 | /actuator/health 返回 UP |
| 版本确认 | ✅ 通过 | /actuator/info 返回 v1.3.0 |
| 数据库连接 | ✅ 通过 | 连接池正常，活跃连接 5 |
| Redis 连接 | ✅ 通过 | 连接正常 |
| 启动日志 | ✅ 通过 | 无 ERROR 级别日志 |
| 端口监听 | ✅ 通过 | 8080, 8081 正常监听 |

---

## 📝 变更日志 (CHANGELOG)

### v1.3.0 (2026-01-31)

#### 新功能
- 用户模块: 新增手机号登录功能 (#123)
- 订单模块: 支持批量导出订单 (#125)

#### Bug 修复
- 修复用户列表分页问题 (#124)

#### 数据库变更
- t_user 表新增 phone 字段索引
- t_order 表新增 export_status 字段

#### 配置变更
- 新增 redis.timeout 配置项

---

## 🔗 相关链接

| 链接 | 地址 |
|------|------|
| Jenkins 构建 | http://jenkins/job/product-a/123 |
| 服务地址 | http://192.168.1.100:8080 |
| 备份位置 | /backup/product-a/20260131-103000/ |
| 发布包 | /releases/product-a/v1.3.0/ |

---

## ⚠️ 回滚说明

如需回滚，请执行以下命令：

```
@小龙虾 回滚 product-a 到 v1.2.0 在 test-server-01
```

### 注意事项

1. **DDL 变更需要手动回滚**
   - 回滚脚本位于: `/releases/product-a/v1.3.0/sql/rollback/`
   - 请按逆序执行回滚脚本

2. **数据变更**
   - DML 脚本已执行，回滚可能导致数据不一致
   - 建议先评估影响再决定是否回滚

3. **备份恢复**
   - JAR 包备份: `/backup/product-a/20260131-103000/jars/`
   - 配置备份: `/backup/product-a/20260131-103000/config/`

---

## 📊 资源使用

| 指标 | 部署前 | 部署后 |
|------|--------|--------|
| CPU 使用率 | 15% | 18% |
| 内存使用 | 2.1GB | 2.3GB |
| 磁盘使用 | 45GB | 45.5GB |

---

*报告生成时间: 2026-01-31 10:33:30*
*报告生成工具: OpenClaw Deploy Reporter v1.0*

---

## 钉钉通知模板

### 成功通知（简要版）

```
🎉 部署成功

📦 product-a v1.3.0
🖥️ test-server-01 (测试环境)
⏱️ 耗时 3m 25s
👤 操作人: 张三

变更概要:
• 新增手机号登录功能
• 修复用户列表分页问题
• 2个DDL + 1个DML

🔗 详情: http://xxx/deploy/report/12345
```

### 失败通知

```
❌ 部署失败

📦 product-a v1.3.0
🖥️ test-server-01 (测试环境)
👤 操作人: 张三

失败阶段: SQL 执行
失败脚本: 002_add_order_column.sql
错误信息: Duplicate column name 'export_status'

⚠️ 已自动回滚到 v1.2.0

🔗 详情: http://xxx/deploy/report/12345
```

### 需要确认通知

```
⚠️ 部署需要确认

📦 product-a v1.3.0
🖥️ test-server-01 (测试环境)

检测到以下风险:
• DDL 变更: 2 个文件
• 涉及核心表: t_user, t_order

请确认是否继续？
回复: 确认 / 取消 / 查看详情
```
